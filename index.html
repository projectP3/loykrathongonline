<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏•‡∏≠‡∏¢‡∏Å‡∏£‡∏∞‡∏ó‡∏á‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå | ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡∏ó‡∏á</title>
  <link rel="stylesheet" href="style1.css">
</head>
<body>
  <div class="title-image">
    <img src="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠.png" alt="‡∏•‡∏≠‡∏¢‡∏Å‡∏£‡∏∞‡∏ó‡∏á‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå">
  </div>

  <div class="river"></div>

<div class="button-area">
  <a class="btn" href="manu.html"><span>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡∏ó‡∏á</span></a>
</div>


  <!-- ‚úÖ ‡πÇ‡∏´‡∏•‡∏î Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore-compat.js"></script>

 <script>
  // üî• ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡πÄ‡∏≠‡πá‡∏á)
  const firebaseConfig = {
    apiKey: "AIzaSyCelpYvwoijqpoTsW-AhkD0scf3BRSB2Dg",
    authDomain: "loy-krathong-online.firebaseapp.com",
    projectId: "loy-krathong-online",
    storageBucket: "loy-krathong-online.firebasestorage.app",
    messagingSenderId: "89800674529",
    appId: "1:89800674529:web:8af447aba6a5fb2067fba0",
    measurementId: "G-41Z1GFH6RQ"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const river = document.querySelector(".river");

  // ====== ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á/‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß ======
  const WATER_MIN = 30;          // ‡∏Ç‡∏≠‡∏ö‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏ô
  const WATER_MAX = 160;         // ‡∏Ç‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏ô
  const MIN_LANE_GAP = 26;       // ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏•‡∏ô (px)
  const BASE_DELAY_STEP = 2.8;   // ‡∏î‡∏µ‡πÄ‡∏•‡∏¢‡πå‡∏ê‡∏≤‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏£‡∏∞‡∏ó‡∏á (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
  const JITTER = 1.2;            // ‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏Å‡∏ß‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏î‡∏î‡∏µ‡πÄ‡∏•‡∏¢‡πå (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
  const DURATION_MIN = 35;       // ‡∏ä‡πâ‡∏≤‚Äì‡πÄ‡∏£‡πá‡∏ß (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
  const DURATION_MAX = 55;

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡∏∏‡∏î‡πÄ‡∏•‡∏ô‡∏ó‡∏µ‡πà‡∏´‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ MIN_LANE_GAP
  function buildLanes(n) {
    const lanes = [];
    const range = WATER_MAX - WATER_MIN;
    const approxCount = Math.max(1, Math.floor(range / MIN_LANE_GAP));
    const count = Math.min(n, approxCount);

    const gap = range / (count + 1);
    for (let i = 1; i <= count; i++) {
      const jitter = (Math.random() - 0.5) * 10; // ‡∏Ç‡∏¢‡∏±‡∏ö‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥
      lanes.push(Math.round(WATER_MIN + i * gap + jitter));
    }
    // ‡∏ñ‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡∏ó‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏•‡∏ô ‡πÉ‡∏´‡πâ‡∏ß‡∏ô‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏ô‡πÄ‡∏î‡∏¥‡∏°
    return (idx) => lanes[idx % lanes.length];
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏∏‡πà‡∏°‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á [a, b]
  const rand = (a, b) => a + Math.random() * (b - a);

  db.collection("krathongWishes")
    .orderBy("timestamp", "desc")
    .limit(40)
    .onSnapshot((snapshot) => {
      river.innerHTML = "";

      const docs = snapshot.docs;
      const getLaneForIndex = buildLanes(docs.length);

      // ‡∏î‡∏µ‡πÄ‡∏•‡∏¢‡πå‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‡πÉ‡∏´‡πâ‡∏ä‡∏∏‡∏î‡πÅ‡∏£‡∏Å‡πÑ‡∏°‡πà‡∏ä‡∏ô‡∏Å‡∏±‡∏ô
      const baseOffset = rand(0, 3);

      docs.forEach((docSnap, i) => {
        const d = docSnap.data();

        // --- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á/‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß ---
        const lane = getLaneForIndex(i);
        const delay = baseOffset + i * BASE_DELAY_STEP + rand(0, JITTER);
        const duration = rand(DURATION_MIN, DURATION_MAX);

        // ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ó‡∏á‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏°‡∏µ‡∏°‡∏¥‡∏ï‡∏¥
        const scale = rand(0.9, 1.12);

        // --- DOM ---
        const wrap = document.createElement("div");
        wrap.className = "krathong-wrap";
        wrap.style.bottom = `${lane}px`;
        wrap.style.animation = `floatAcross ${duration}s linear ${delay}s infinite`;

        const bubble = document.createElement("div");
        bubble.className = "wish-bubble";
        bubble.innerHTML = `<div class="text">${d.wish || ""}</div>`;

        const img = document.createElement("img");
        img.className = "krathong-img";
        img.src = d.krathong || "‡∏û‡∏ô‡∏≤‡∏ô‡∏≤‡∏Å.png";
        img.style.transform = `scale(${scale})`; // ‡∏¢‡πà‡∏≠/‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏ö‡∏≤ ‡πÜ

        wrap.appendChild(bubble);
        wrap.appendChild(img);
        river.appendChild(wrap);
      });
    });
</script>
</body>